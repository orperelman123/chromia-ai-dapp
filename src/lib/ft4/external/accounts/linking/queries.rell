/**
 * Retrieves all account_links based on the selected filter of account_link_filter, paginated
 * 
 * @see utils.paged_result for information about pagination
 * 
 * @param account_link_filter  filter with indexed fileds from the account_link entity
 * @param page_size      the size of the pages to retrieve
 * @param page_cursor    a pointer to where the page should start
 */
query get_account_links_filtered(account_link_filter?, page_size: integer?, page_cursor: text?) {
    val before_rowid = utils.before_rowid(page_cursor);
    if (account_link_filter?.type??) require(
        account_link_filter?.secondary_id??,
        "MALFORMED FILTER: composite index (secondary, type) - secondary required"
    );
    return utils.make_page(
        linking.account_link @* {
                if (account_link_filter?.account_ids??) .account.id in account_link_filter?.account_ids!! else true,
                if (account_link_filter?.secondary_id??) .secondary.id == account_link_filter!!.secondary_id else true,
                if (account_link_filter?.type??) .type == account_link_filter!!.type else true,
                .rowid > (before_rowid ?: rowid(0))
            } (
                utils.pagination_result(
            data = map_account_link($).to_gtv_pretty(),
            rowid = .rowid
        )
            ) limit utils.fetch_data_size(page_size),
        page_size
    );
}
